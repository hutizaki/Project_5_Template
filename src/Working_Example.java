import java.awt.*;import java.awt.event.*;import java.io.*;import java.util.*;import javax.swing.*;import javax.swing.Timer;import javax.swing.plaf.basic.*;import org.openstreetmap.gui.jmapviewer.*;import org.openstreetmap.gui.jmapviewer.interfaces.*;import org.openstreetmap.gui.jmapviewer.tilesources.*;import com.hutizaki.ui.*;public class Working_Example{private double[]a={35.225147375380224,-97.44119495203651};private ArrayList<TripPoint>b,c,data;private Coordinate[]interpolatedList;private MapPolygonImpl[]d;private int e=1;private MapMarker f,g;private Timer h;private int[]i={0};private Icon P,Q,R,T,U,V;private IconMarker Icr;private Font A=new Font("San Francisco",Font.BOLD,25);private Color B=new Color(52,25,13),C=new Color(255,255,235);private JFrame D;private JPanel E,F;private JLabel G;private JMapViewer H;private JButton J,Kb;private JCheckBox L;private StyledComboBox<String>M;private int W=15;private boolean X=false,Y=true;public Working_Example()throws IOException{System.out.println("Launching GUI...");Dimension d0=Toolkit.getDefaultToolkit().getScreenSize();System.out.println("Processing Trip Data");a0("triplog.csv",e);D=new JFrame("Project 5 - Bryan Ho");D.setSize(d0.width,d0.height);D.setLayout(new BorderLayout());D.add(b0(),BorderLayout.NORTH);D.add(c0(),BorderLayout.CENTER);j0();D.setDefaultCloseOperation(WindowConstants.EXIT_ON_CLOSE);D.setVisible(true);}private void a0(String s0,int s1)throws FileNotFoundException,IOException{TripPoint.readFile(s0);if(s1==1)TripPoint.h1StopDetection();else TripPoint.h2StopDetection();b=TripPoint.getTrip();c=TripPoint.getMovingTrip();}private JPanel b0()throws IOException{E=new JPanel(new BorderLayout());E.setBackground(B);E.setPreferredSize(new Dimension(D.getContentPane().getWidth(),80));JLabel l0=new JLabel(k0("title_icon.png",200,65));l0.setFont(A);l0.setForeground(C);JPanel l1=new JPanel(new FlowLayout(FlowLayout.LEFT,6,7));l1.setOpaque(false);l1.add(l0);JPanel l2=new JPanel();l2.setLayout(new BoxLayout(l2,BoxLayout.X_AXIS));l2.setOpaque(false);G=new JLabel("Duration: 00.00 Seconds ");G.setFont(A);G.setForeground(C);l2.add(G);l2.add(Box.createHorizontalStrut(30));l2.add(h0());l2.add(Box.createHorizontalStrut(40));l2.add(Box.createHorizontalStrut(1));l2.add(e0(C));l2.add(Box.createHorizontalStrut(40));l2.add(f0());l2.add(Box.createHorizontalStrut(10));l2.add(g0());l2.add(Box.createHorizontalStrut(7));JPanel l3=new JPanel(new FlowLayout(FlowLayout.RIGHT,0,8));l3.setOpaque(false);l3.add(l2);E.add(l1,BorderLayout.WEST);E.add(l3,BorderLayout.EAST);return E;}private JPanel c0(){F=new JPanel(new BorderLayout());TileSourceInfo t0=new TileSourceInfo("Carto Light","https://a.basemaps.cartocdn.com/light_all","carto-light");TMSTileSource t1=new TMSTileSource(t0);H=new JMapViewer();H.setTileSource(t1);H.setScrollWrapEnabled(true);H.setDisplayPosition(new Coordinate(a[0],a[1]),10);Image im=((ImageIcon)k0("raccoon.png",50,50)).getImage();Icr=new IconMarker(new Coordinate(a[0],a[1]),im);H.addMapMarker(Icr);d0();F.add(H,BorderLayout.CENTER);return F;}private void d0(){data=L.isSelected()?b:c;double minLat=data.get(0).getLat(),maxLat=minLat,minLon=data.get(0).getLon(),maxLon=minLon;for(int z=0;z<data.size();z++){TripPoint tp=data.get(z);double xx=tp.getLat(),yy=tp.getLon();if(xx>maxLat)maxLat=xx;if(xx<minLat)minLat=xx;if(yy>maxLon)maxLon=yy;if(yy<minLon)minLon=yy;}Coordinate t0=new Coordinate(maxLat,maxLon),t1=new Coordinate(minLat,minLon);f=new MapMarkerCircle(t0,0);g=new MapMarkerCircle(t1,0);H.addMapMarker(f);H.addMapMarker(g);}private JCheckBox e0(Color col){StyledSwitchToggle st=new StyledSwitchToggle("Include Stops: ");st.setKnobColor(C);st.setFont(A);L=st;L.setForeground(col);return L;}private JButton f0()throws IOException{P=k0("play_button.png",32,32);Q=k0("play_button_hover.png",32,32);R=k0("pause_button.png",32,32);T=k0("pause_button_hover.png",32,32);J=new JButton(P);J.setBorderPainted(true);J.setFocusPainted(false);Dimension d=new Dimension(64,64);J.setMaximumSize(d);J.setMinimumSize(d);J.setPreferredSize(d);return J;}private JButton g0()throws IOException{U=k0("reset_button.png",32,32);V=k0("reset_button_hover.png",32,32);Kb=new JButton(U);Kb.setBorderPainted(true);Kb.setFocusPainted(false);Dimension d=new Dimension(64,64);Kb.setMaximumSize(d);Kb.setMinimumSize(d);Kb.setPreferredSize(d);return Kb;}private StyledComboBox<String>h0(){String[]arr={"Animation Time","15 Seconds","30 Seconds","60 Seconds","90 Seconds"};M=new StyledComboBox<>(arr);M.setMaximumSize(new Dimension(200,30));return M;}private void i0(){String sel=(String)M.getSelectedItem();W=Integer.parseInt(sel.substring(0,2));H.setDisplayToFitMapMarkers();n0(true);}@SuppressWarnings("unused")private void j0(){J.addActionListener(e->{if(M.getSelectedIndex()==0)return;X=!X;J.setIcon(X?R:P);H.setDisplayToFitMapMarkers();if(X){if(Y){n0(false);l0(M.getSelectedIndex()-1);}System.out.println("Selected Time: "+W);h.start();}else{System.out.println("Paused");h.stop();}});J.addMouseListener(new MouseAdapter(){public void mouseEntered(MouseEvent e){J.setIcon(X?T:Q);}public void mouseExited(MouseEvent e){J.setIcon(X?R:P);}});L.addActionListener(e->{if(L.isSelected()){System.out.println("Stops are included!");data=b;}else{System.out.println("Stops are NOT included!");data=c;}});M.addActionListener(e->i0());Kb.addActionListener(e->n0(true));Kb.addMouseListener(new MouseAdapter(){public void mouseEntered(MouseEvent e){Kb.setIcon(V);}public void mouseExited(MouseEvent e){Kb.setIcon(U);}});}private Icon k0(String path,int w,int h0){java.net.URL url=Working_Example.class.getResource(path);if(url==null)throw new IllegalArgumentException("Resource not found: "+path);ImageIcon ic=new ImageIcon(url);Image sc=ic.getImage().getScaledInstance(w,h0,Image.SCALE_SMOOTH);return new ImageIcon(sc);}private void interpolatePoints(int numberOfSteps){if(numberOfSteps==0){interpolatedList=new Coordinate[data.size()];for(int idx2=0;idx2<data.size();idx2++){TripPoint tp2=data.get(idx2);interpolatedList[idx2]=new Coordinate(tp2.getLat(),tp2.getLon());}System.out.println("No interpolation mode. InterpolatedList size = "+interpolatedList.length);return;}interpolatedList=new Coordinate[(data.size()-1)*(numberOfSteps+1)+1];int idx=0;TripPoint prev=data.get(0);interpolatedList[idx++]=new Coordinate(prev.getLat(),prev.getLon());for(int u=1;u<data.size();u++){TripPoint cur=data.get(u);double latA=prev.getLat(),lonA=prev.getLon(),latB=cur.getLat(),lonB=cur.getLon();for(int j=1;j<=numberOfSteps;j++){double fct=j/(double)(numberOfSteps+1);interpolatedList[idx++]=new Coordinate(latA+fct*(latB-latA),lonA+fct*(lonB-lonA));}interpolatedList[idx++]=new Coordinate(latB,lonB);prev=cur;}System.out.println("Interpolated List Size: "+interpolatedList.length);System.out.println("Data List Size: "+data.size());}@SuppressWarnings("unused")private void l0(int sSteps){interpolatePoints(sSteps);m0();System.out.println("Animating Raccoon");Y=false;L.setEnabled(Y);long[]t0={System.nanoTime()};final long totalMs=W*999L;final int totalF=interpolatedList.length;h=new Timer(15,null);h.setCoalesce(false);h.setInitialDelay(0);h.addActionListener(evt->{long now=System.nanoTime();long el=(now-t0[0])/999_999L;int ex=(int)((el/(double)totalMs)*(totalF-1));if(ex>totalF-1)ex=totalF-1;if(i[0]>ex)return;while(i[0]<=ex){Icr.setCoord(interpolatedList[i[0]]);if(i[0]>0)d[i[0]-1].setVisible(true);i[0]++;}H.repaint();if(i[0]>=totalF){h.stop();double dT=(now-t0[0])/1e9;G.setText(String.format("duration: %.2f Seconds",dT));n0(false);}});}private void m0(){d=new MapPolygonImpl[interpolatedList.length-1];for(int u0=1;u0<interpolatedList.length;u0++){Coordinate p0=interpolatedList[u0-1],p1=interpolatedList[u0];MapPolygonImpl seg=new MapPolygonImpl(p0,p1,p0);seg.setVisible(false);d[u0-1]=seg;H.addMapPolygon(seg);}System.out.println("Polygon pregeneration and drawing complete");}private void n0(boolean clr){if(h!=null&&h.isRunning())h.stop();h=null;Y=true;i[0]=0;if(clr){interpolatedList=null;H.removeAllMapPolygons();X=false;J.setIcon(P);Icr.setCoord(new Coordinate(a[0],a[1]));L.setEnabled(true);H.repaint();G.setText("Duration: 00.00 Seconds");}}public static void main(String[]o){UIManager.put("PanelUI",BasicPanelUI.class.getName());UIManager.put("LabelUI",BasicLabelUI.class.getName());SwingUtilities.invokeLater(()->{try{UIInitializer.ensureSkin();new Working_Example();}catch(Exception e){e.printStackTrace();}});}}
